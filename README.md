# Maum (마음) BBS

마음 BBS는 순수 C로 작성된 가벼운 텍스트 기반 커뮤니티 서버입니다. 텔넷(TELNET) 접속을 기본으로 제공하며, 표준 입력/출력 모드를 통해 기존 SSH 데몬과도 쉽게 연동할 수 있습니다. 실시간 채팅과 단일 게시판(조회/등록/삭제)을 모두 실제로 동작하도록 구현했습니다.

## 주요 기능

- ✅ **실제 텔넷 서버** – 다중 접속을 지원하며 각 사용자는 고유한 스레드에서 세션을 진행합니다.
- ✅ **실시간 채팅방** – 입장/퇴장 알림과 브로드캐스트 메시지를 제공하며 `/exit` 명령으로 빠져나올 수 있습니다.
- ✅ **간단한 게시판** – 게시글 목록 조회, 단일 행 글쓰기, 작성자 본인 확인 후 삭제까지 지원합니다.
- ✅ **MOTD 지원** – 접속 시 `motd.txt` 파일 내용을 출력합니다.
- ✅ **표준입력(STDIN) 모드** – `./maum --stdio` 로 실행하면 한 명의 사용자를 처리하는 인터랙티브 세션이 되어, OpenSSH `ForceCommand` 등과 바로 연결할 수 있습니다.

## 빌드

필수 도구는 POSIX 호환 C 컴파일러와 `make` 입니다.

```bash
make
```

추가로 `libssh`가 설치되어 있다면(선택사항) 향후 내장 SSH 서버 기능을 활성화할 수 있도록 빌드시 자동으로 감지합니다. 현재 저장소에는 내장 SSH 서버 코드가 포함되어 있지 않으므로, SSH 접속은 아래의 `--stdio` 연동 방식을 이용하십시오.

## 실행 방법

### 1. 텔넷 서버 모드

```bash
./maum
```

서버는 설정 파일(`maum.conf`)에 지정된 호스트/포트에서 텔넷을 대기합니다. 기본값은 `0.0.0.0:2323` 입니다. 접속 예시는 다음과 같습니다.

```bash
# 로컬 테스트
telnet 127.0.0.1 2323
```

서버를 종료하려면 `Ctrl+C` 를 누르십시오.

### 2. 표준 입력/출력(STDIN) 모드 – SSH 연동용

```bash
./maum --stdio
```

이 모드는 한 명의 사용자를 처리하고 종료됩니다. 다음과 같은 방식으로 OpenSSH와 연동할 수 있습니다.

1. OpenSSH 서버 설정(`/etc/ssh/sshd_config`)에 전용 계정을 추가하고 `ForceCommand` 로 `maum --stdio` 를 지정합니다.
2. 또는 `~/.ssh/authorized_keys` 의 공개키 옵션에 `command="/path/to/maum --stdio"` 를 부여합니다.
3. 사용자는 평소처럼 `ssh` 로 접속하면 마음 BBS 인터페이스가 나타납니다.

## 설정 파일 (`maum.conf`)

| 키 | 설명 | 기본값 |
| --- | --- | --- |
| `telnet_host` | 텔넷 리스닝 호스트 | `0.0.0.0` |
| `telnet_port` | 텔넷 포트 | `2323` |
| `motd_path` | MOTD 파일 경로 | `motd.txt` |
| `board_path` | 게시판 데이터 파일 경로 | `data/posts.db` |
| `ssh_host` | (미래용) 내장 SSH 서버 호스트 | `0.0.0.0` |
| `ssh_port` | (미래용) 내장 SSH 서버 포트 | `2222` |
| `host_key_path` | (미래용) 내장 SSH 서버 호스트키 | `data/maum_host_ed25519` |
| `enable_builtin_ssh` | true일 경우 내장 SSH 서버 사용 시도 (libssh 필요) | `false` |

> 📌 현재 빌드는 내장 SSH 서버를 포함하지 않으므로 `enable_builtin_ssh` 는 기본값 `false` 로 유지하세요.

## 데이터 파일

- `motd.txt` – 접속 시 출력되는 환영 메시지
- `data/posts.db` – `id|timestamp|author|content` 형식의 단일 게시판 데이터
- `data/maum_host_ed25519` – SSH 연동 시 사용할 호스트키를 저장할 위치 (기본은 빈 파일)

## 개발 가이드

- 모든 네트워크 세션은 `session_manager` 를 통해 처리됩니다.
- 게시판 저장소는 간단한 텍스트 파일이며, 다중 쓰레드 환경을 고려해 뮤텍스를 사용합니다.
- 채팅방은 연결된 세션들의 출력 스트림을 공유 리스트에 보관하고 브로드캐스트합니다.
- `./maum --stdio` 실행은 테스트 자동화나 SSH 강제 명령과의 연동에 유용합니다.

## 향후 계획

- libssh 기반 내장 SSH 서버 구현
- 여러 게시판/카테고리 지원
- 사용자 인증 및 계정 시스템
- ANSI 컬러 및 한글 단축키 개선

즐거운 BBS 해킹 되세요! 💬
